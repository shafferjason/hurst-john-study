<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Music - Hurst Class Study</title>
    <link rel="stylesheet" href="style.css?v=59">
    <style>
        /* Override container for two-column layout */
        body {
            padding: 0;
            overflow-x: hidden;
            overflow-y: auto;
            min-height: 100vh;
        }
        
        .top-nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px 20px 5px 20px;
        }
        
        .top-nav .lesson-header {
            margin-bottom: 0.5rem;
        }
        
        .top-nav .lesson-header h1 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }
        
        .top-nav .scripture-reference {
            font-size: 0.95rem;
            margin-bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .header-logo {
            height: 4.5rem;
            width: auto;
            filter: drop-shadow(0 0 8px rgba(201, 164, 122, 0.3));
            vertical-align: middle;
        }
        
        /* Two-column layout - Apple Music style */
        .music-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 15px 20px;
            height: calc(100vh - 100px);
            overflow: visible;
            box-sizing: border-box;
        }
        
        /* Left sidebar - Song list with proper scrolling */
        .sidebar {
            background: 
                repeating-linear-gradient(
                    90deg,
                    rgba(42, 38, 33, 0.15) 0px,
                    rgba(35, 32, 28, 0.1) 0.5px,
                    transparent 1px,
                    transparent 3px
                ),
                rgba(42, 38, 33, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            height: 100%;
            box-shadow: 
                inset 0 3px 10px rgba(0, 0, 0, 0.5),
                0 4px 15px rgba(0, 0, 0, 0.4);
            border-left: 2px solid rgba(212, 165, 116, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar h2 {
            font-size: 1.1rem;
            color: #d4a574;
            margin: 0 0 1rem 0;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            flex-shrink: 0;
        }
        
        .song-list-compact {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            overflow-y: scroll;
            overflow-x: hidden;
            padding-right: 0.5rem;
            flex: 1;
            min-height: 0;
        }
        
        /* Custom scrollbar - always visible */
        .song-list-compact::-webkit-scrollbar {
            width: 8px;
        }
        
        .song-list-compact::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }
        
        .song-list-compact::-webkit-scrollbar-thumb {
            background: rgba(212, 165, 116, 0.5);
            border-radius: 4px;
        }
        
        .song-list-compact::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 165, 116, 0.7);
        }
        
        .song-item-compact {
            padding: 0.6rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .song-item-compact:hover {
            background: rgba(212, 165, 116, 0.15);
            border-color: rgba(212, 165, 116, 0.3);
        }
        
        .song-item-compact.active {
            background: linear-gradient(180deg,
                rgba(240, 212, 168, 0.25) 0%,
                rgba(212, 165, 116, 0.2) 100%
            );
            border-color: rgba(240, 212, 168, 0.5);
            box-shadow: 0 0 12px rgba(240, 212, 168, 0.3);
        }
        
        /* Now Playing Indicator - Animated Sound Bars */
        .now-playing-indicator {
            display: none;
            align-items: flex-end;
            gap: 2px;
            height: 16px;
            padding-left: 0.5rem;
            flex-shrink: 0;
        }
        
        .song-item-compact.playing .now-playing-indicator {
            display: flex;
        }
        
        .now-playing-indicator .bar {
            width: 3px;
            background: linear-gradient(to top, #c9a47a, #f0d4a8);
            border-radius: 1px;
            animation: soundBars 0.8s ease-in-out infinite;
        }
        
        .now-playing-indicator .bar:nth-child(1) {
            height: 60%;
            animation-delay: 0s;
        }
        
        .now-playing-indicator .bar:nth-child(2) {
            height: 100%;
            animation-delay: 0.2s;
        }
        
        .now-playing-indicator .bar:nth-child(3) {
            height: 40%;
            animation-delay: 0.4s;
        }
        
        .now-playing-indicator .bar:nth-child(4) {
            height: 80%;
            animation-delay: 0.1s;
        }
        
        @keyframes soundBars {
            0%, 100% {
                transform: scaleY(0.3);
            }
            50% {
                transform: scaleY(1);
            }
        }
        
        /* Paused state - bars frozen */
        .song-item-compact.paused .now-playing-indicator {
            display: flex;
        }
        
        .song-item-compact.paused .now-playing-indicator .bar {
            animation-play-state: paused;
        }
        
        .song-item-thumbnail {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        .song-item-thumbnail.placeholder {
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.3), rgba(180, 140, 95, 0.2));
            display: flex;
            align-items: center;
            justify-content: center;
            color: #d4a574;
            font-size: 1.2rem;
        }
        
        .song-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .song-item-number {
            color: #d4a574;
            font-size: 0.85rem;
            font-family: Georgia, serif;
            margin-right: 0.5rem;
        }
        
        .song-item-title {
            color: #e8e4dc;
            font-size: 0.9rem;
            font-family: Georgia, serif;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Right main area - Current song display - SMALLER */
        .main-display {
            background: 
                repeating-linear-gradient(
                    90deg,
                    rgba(42, 38, 33, 0.15) 0px,
                    rgba(35, 32, 28, 0.1) 0.5px,
                    transparent 1px,
                    transparent 3px
                ),
                radial-gradient(ellipse at 30% 30%, rgba(50, 45, 40, 0.3) 0%, transparent 50%),
                rgba(42, 38, 33, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 
                inset 0 3px 10px rgba(0, 0, 0, 0.5),
                0 4px 15px rgba(0, 0, 0, 0.4);
            border-left: 2px solid rgba(212, 165, 116, 0.4);
            height: 100%;
            overflow-y: auto;
            overflow-x: visible;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            box-sizing: border-box;
        }
        
        /* Scrollbar for main display */
        .main-display::-webkit-scrollbar {
            width: 6px;
        }
        
        .main-display::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }
        
        .main-display::-webkit-scrollbar-thumb {
            background: rgba(212, 165, 116, 0.4);
            border-radius: 3px;
        }
        
        .main-display::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 165, 116, 0.6);
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #a8a49b;
            text-align: center;
            flex: 1;
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
            opacity: 0.3;
        }
        
        .empty-state p {
            font-size: 1.2rem;
            font-style: italic;
        }
        
        /* Current song display - SIDE BY SIDE LAYOUT */
        .current-song-display {
            width: 100%;
            max-width: 800px;
            display: none;
            padding-top: 1.5rem;
            box-sizing: border-box;
        }
        
        .current-song-display.active {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            grid-template-areas:
                "image info"
                "image player"
                "image lyrics";
        }
        
        .album-art {
            grid-area: image;
            width: 100%;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            align-self: start;
        }
        
        /* Album art animation container */
        .album-art-container {
            grid-area: image;
            position: relative;
            width: 100%;
        }
        
        .album-art-default {
            display: block;
            transition: opacity 10s ease-in-out;
        }
        
        .album-art-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 10s ease-in-out;
            display: none;
            z-index: 20;
        }
        
        .song-info {
            grid-area: info;
            text-align: left;
            margin-bottom: 1rem;
        }
        
        .song-info h1 {
            font-size: 1.6rem;
            color: #e8e4dc;
            margin-bottom: 0.5rem;
            font-family: Georgia, serif;
            font-weight: 400;
            line-height: 1.3;
        }
        
        .song-info .artist {
            font-size: 1rem;
            color: #d4a574;
            font-style: italic;
            display: block;
            margin-bottom: 0.75rem;
        }
        
        .lesson-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #d4a574;
            text-decoration: none;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            background: rgba(212, 165, 116, 0.1);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .lesson-link:hover {
            background: rgba(212, 165, 116, 0.2);
            border-color: rgba(212, 165, 116, 0.5);
            transform: translateX(-2px);
            box-shadow: 0 2px 8px rgba(212, 165, 116, 0.2);
        }
        
        .lesson-link svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }
        
        /* Audio player on right side */
        .audio-player-main {
            grid-area: player;
            width: 100%;
            box-sizing: border-box;
        }
        
        .player-controls-main {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 1rem;
            margin-bottom: 1.25rem;
        }
        
        .control-btn-main {
            background: linear-gradient(135deg, rgba(42, 38, 33, 0.9) 0%, rgba(30, 28, 25, 0.95) 100%);
            border: 1px solid rgba(212, 165, 116, 0.4);
            color: #d4a574;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(212, 165, 116, 0.1);
        }
        
        .control-btn-main.play-btn {
            width: 52px;
            height: 52px;
        }
        
        .control-btn-main:hover {
            background: linear-gradient(135deg, rgba(52, 48, 43, 0.9) 0%, rgba(40, 38, 35, 0.95) 100%);
            box-shadow: 
                0 4px 12px rgba(212, 165, 116, 0.3),
                inset 0 1px 0 rgba(212, 165, 116, 0.2);
            transform: scale(1.05);
        }
        
        .control-btn-main svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        .control-btn-main.play-btn svg {
            width: 24px;
            height: 24px;
        }
        
        .control-btn-main.repeat-active {
            color: #f0d4a8;
            border-color: #f0d4a8;
            box-shadow: 
                0 0 15px rgba(240, 212, 168, 0.5),
                inset 0 1px 0 rgba(240, 212, 168, 0.3);
        }
        
        .progress-bar-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
        }
        
        .time-display {
            font-size: 0.9rem;
            color: #a8a49b;
            font-family: 'Courier New', monospace;
            min-width: 45px;
        }
        
        .seek-bar {
            flex: 1;
        }
        
        /* Lyrics section on right side */
        .lyrics-section {
            grid-area: lyrics;
            width: 100%;
            margin-top: 0.5rem;
        }
        
        .lyrics-section details {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .lyrics-section summary {
            color: #d4a574;
            cursor: pointer;
            font-weight: 600;
            padding: 0.5rem;
            font-size: 1rem;
        }
        
        .lyrics-section details[open] summary {
            margin-bottom: 0.75rem;
        }
        
        .lyrics-text {
            color: #e0ddd5;
            line-height: 1.7;
            font-family: Georgia, serif;
            white-space: pre-line;
            font-size: 0.95rem;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        /* Scrollbar for lyrics */
        .lyrics-text::-webkit-scrollbar {
            width: 5px;
        }
        
        .lyrics-text::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }
        
        .lyrics-text::-webkit-scrollbar-thumb {
            background: rgba(212, 165, 116, 0.4);
            border-radius: 3px;
        }
        
        .suno-link {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.95rem;
            color: #a8a49b;
        }
        
        .suno-link a {
            color: #d4a574;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .suno-link a:hover {
            color: #f0d4a8;
            text-shadow: 0 0 10px rgba(240, 212, 168, 0.3);
        }
        
        /* Tablet / Smaller desktop screens */
        @media (max-width: 1200px) {
            .music-container {
                grid-template-columns: 320px 1fr;
                gap: 1.5rem;
            }
            
            .current-song-display.active {
                grid-template-columns: 300px 1fr;
                gap: 1.5rem;
            }
        }
        
        /* Mobile responsive */
        @media (max-width: 1024px) {
            /* CRITICAL: Allow scrolling on mobile */
            body {
                overflow-x: hidden !important;
                overflow-y: auto !important;
                height: auto !important;
                min-height: 100vh;
                padding-bottom: 2rem;
            }
            
            .top-nav {
                padding: 8px 15px 5px 15px;
            }
            
            .top-nav .lesson-header h1 {
                font-size: 1.5rem;
            }
            
            .header-logo {
                height: 3rem;
            }
            
            /* FLIPPED LAYOUT: Player first, song list second */
            .music-container {
                display: flex;
                flex-direction: column;
                height: auto !important;
                overflow: visible !important;
                padding: 0 15px 2rem 15px;
                max-width: 100%;
                gap: 1rem;
            }
            
            .main-display {
                order: 1;
                height: auto !important;
                overflow: visible !important;
                padding: 1rem;
            }
            
            .sidebar {
                order: 2;
                position: static;
                margin-bottom: 1rem;
                height: auto !important;
                padding: 1rem;
            }
            
            .sidebar h2 {
                font-size: 0.9rem;
                margin-bottom: 0.75rem;
            }
            
            .song-list-compact {
                max-height: 350px;
            }
            
            .song-item-compact {
                padding: 0.5rem;
            }
            
            .song-item-thumbnail {
                width: 32px;
                height: 32px;
            }
            
            .song-item-title {
                font-size: 0.85rem;
            }
            
            /* Stack vertically on mobile */
            .current-song-display {
                padding-top: 0.5rem;
            }
            
            .current-song-display.active {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "image"
                    "info"
                    "player"
                    "lyrics";
                gap: 0.75rem;
                max-width: 100%;
            }
            
            /* Larger album art on mobile - centered */
            .album-art-container {
                max-width: 280px;
                margin: 0 auto;
            }
            
            .album-art {
                max-width: 100%;
            }
            
            .song-info {
                text-align: center;
            }
            
            .song-info h1 {
                font-size: 1.3rem;
            }
            
            .song-info .artist {
                font-size: 0.9rem;
            }
            
            .player-controls-main {
                justify-content: center;
                gap: 0.75rem;
            }
            
            .control-btn-main {
                width: 36px;
                height: 36px;
            }
            
            .control-btn-main.play-btn {
                width: 46px;
                height: 46px;
            }
            
            .control-btn-main svg {
                width: 16px;
                height: 16px;
            }
            
            .control-btn-main.play-btn svg {
                width: 20px;
                height: 20px;
            }
            
            /* Ensure player doesn't overflow */
            .audio-player-main {
                max-width: 100%;
                box-sizing: border-box;
                padding: 1rem 0.75rem;
            }
            
            /* Hide corner brackets on mobile */
            .audio-player-main::before,
            .audio-player-main::after {
                display: none;
            }
            
            /* Time display mobile fixes */
            .progress-bar-container {
                gap: 0.5rem;
            }
            
            .time-display {
                min-width: 36px;
                font-size: 0.75rem;
                flex-shrink: 0;
            }
            
            .lyrics-section {
                margin-top: 0.25rem;
            }
            
            .lyrics-section details {
                padding: 0.75rem;
            }
            
            .lyrics-section summary {
                font-size: 0.9rem;
                padding: 0.25rem;
            }
            
            .lyrics-text {
                font-size: 0.85rem;
                max-height: 150px;
            }
            
            .suno-link {
                font-size: 0.85rem;
                margin-top: 0.5rem;
            }
        }
        
        /* Extra small phones */
        @media (max-width: 480px) {
            .top-nav .lesson-header h1 {
                font-size: 1.25rem;
            }
            
            .header-logo {
                height: 2.5rem;
            }
            
            .song-list-compact {
                max-height: 320px;
            }
            
            .album-art-container {
                max-width: 240px;
            }
            
            .song-info h1 {
                font-size: 1.1rem;
            }
            
            .control-btn-main {
                width: 32px;
                height: 32px;
            }
            
            .control-btn-main.play-btn {
                width: 42px;
                height: 42px;
            }
        }
    </style>
</head>
<body>
    <!-- Sticky Breadcrumb Navigation -->
    <nav class="breadcrumb-nav">
        <div class="breadcrumb-container">
            <div class="breadcrumb">
                <a href="index.html">Home</a>
                <span class="separator">›</span>
                <span class="current">The Music</span>
            </div>
            <a href="index.html" class="back-button">
                <span class="back-arrow">←</span>
                <span class="back-text">Back to All Lessons</span>
            </a>
        </div>
    </nav>

    <div class="top-nav">
        
        <header class="lesson-header">
            <h1>THE MUSIC</h1>
            <p class="scripture-reference">
                Songs from <img src="logo.svg" alt="The Tenth Hour" class="header-logo">
            </p>
        </header>
    </div>
    
    <div class="music-container">
        <!-- Left Sidebar - Song List -->
        <aside class="sidebar">
            <h2>All Songs</h2>
            <div class="song-list-compact" id="song-list">
                <!-- Songs will be inserted here -->
            </div>
        </aside>
        
        <!-- Right Main Display - Current Song -->
        <main class="main-display">
            <!-- Empty state -->
            <div class="empty-state" id="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                </svg>
                <p>Select a song to begin</p>
            </div>
            
            <!-- Current song display -->
            <div class="current-song-display" id="current-display">
                <div class="album-art-container" id="albumArtContainer">
                    <img id="album-art" class="album-art album-art-default" alt="">
                    <!-- Animation frames will be added by JavaScript if they exist -->
                </div>
                
                <div class="song-info">
                    <h1 id="song-title"></h1>
                    <span class="artist">A song by The Tenth Hour</span>
                    <a href="#" id="lesson-link" class="lesson-link" style="display:none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                        </svg>
                        View Lesson
                    </a>
                </div>
                
                <div class="audio-player-main">
                    <audio id="main-audio"></audio>
                    
                    <!-- Speaker icon in upper right -->
                    <div class="audio-speaker-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                        </svg>
                    </div>
                    
                    <div class="player-controls-main">
                        <button id="prev-btn" class="control-btn-main" aria-label="Previous Song">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                            </svg>
                        </button>
                        
                        <button id="play-pause-btn" class="control-btn-main play-btn" aria-label="Play/Pause">
                            <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            <svg class="pause-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none;">
                                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                            </svg>
                        </button>
                        
                        <button id="next-btn" class="control-btn-main" aria-label="Next Song">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                            </svg>
                        </button>
                        
                        <button id="repeat-btn" class="control-btn-main" aria-label="Repeat All">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="progress-bar-container">
                        <div id="current-time" class="time-display">0:00</div>
                        <input type="range" id="seek-bar" class="seek-bar" value="0" min="0" max="100" aria-label="Audio seek bar">
                        <div id="duration" class="time-display">0:00</div>
                    </div>
                </div>
                
                <div class="lyrics-section" id="lyrics-section" style="display:none;">
                    <details>
                        <summary>View Song Lyrics</summary>
                        <div class="lyrics-text" id="lyrics-text"></div>
                    </details>
                </div>
                
                <p class="suno-link" id="suno-link" style="display:none;"></p>
            </div>
        </main>
    </div>
    
    <script src="data.js"></script>
    <script>
        let currentSongIndex = -1;
        let isRepeatAll = false;
        
        const audio = document.getElementById('main-audio');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = playPauseBtn.querySelector('.play-icon');
        const pauseIcon = playPauseBtn.querySelector('.pause-icon');
        const seekBar = document.getElementById('seek-bar');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const songList = document.getElementById('song-list');
        const emptyState = document.getElementById('empty-state');
        const currentDisplay = document.getElementById('current-display');
        const albumArt = document.getElementById('album-art');
        const albumArtContainer = document.getElementById('albumArtContainer');
        const songTitle = document.getElementById('song-title');
        const lyricsSection = document.getElementById('lyrics-section');
        const lyricsText = document.getElementById('lyrics-text');
        const sunoLink = document.getElementById('suno-link');
        const lessonLink = document.getElementById('lesson-link');
        
        // Animation variables
        let animationInterval = null;
        let animationFramesAvailable = false;
        let imageFrame1, imageFrame2, imageFrame3;
        const loopPattern = [1, 2, 3, 2];
        let currentPatternIndex = 0;
        
        // Format time helper
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Detect which lesson they came from
        const urlParams = new URLSearchParams(window.location.search);
        const fromLessonId = urlParams.get('from');
        let autoLoadIndex = -1;
        
        if (fromLessonId) {
            autoLoadIndex = lessonData.findIndex(lesson => lesson.id === fromLessonId);
        }
        
        // Build compact song list with thumbnails
        lessonData.forEach((lesson, index) => {
            if (lesson.audio_file) {
                const songItem = document.createElement('div');
                songItem.className = 'song-item-compact';
                songItem.dataset.index = index;
                
                // Create thumbnail
                let thumbnailHTML = '';
                if (lesson.image_url) {
                    thumbnailHTML = `<img src="${lesson.image_url}" alt="${lesson.song_title}" class="song-item-thumbnail">`;
                } else {
                    thumbnailHTML = `<div class="song-item-thumbnail placeholder">♪</div>`;
                }
                
                songItem.innerHTML = `
                    ${thumbnailHTML}
                    <div class="song-item-info">
                        <span class="song-item-number">${index + 1}.</span>
                        <span class="song-item-title">${lesson.song_title}</span>
                    </div>
                    <div class="now-playing-indicator">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                `;
                songItem.addEventListener('click', () => loadSong(index));
                songList.appendChild(songItem);
            }
        });
        
        // Load a song
        function loadSong(index) {
            currentSongIndex = index;
            const lesson = lessonData[index];
            
            // Reset any existing animation
            resetAnimation();
            
            // Hide empty state, show player
            emptyState.style.display = 'none';
            currentDisplay.classList.add('active');
            
            // Update UI
            songTitle.textContent = lesson.song_title;
            audio.src = lesson.audio_file;
            
            // Set lesson link
            lessonLink.href = `lesson.html?id=${lesson.id}`;
            lessonLink.style.display = 'inline-flex';
            
            if (lesson.image_url) {
                albumArt.src = lesson.image_url;
                albumArt.alt = lesson.song_title;
            }
            
            // Setup animation for this song
            setupSongAnimation(lesson.id);
            
            if (lesson.song_lyrics) {
                lyricsText.textContent = lesson.song_lyrics;
                lyricsSection.style.display = 'block';
            } else {
                lyricsSection.style.display = 'none';
            }
            
            if (lesson.suno_link) {
                sunoLink.innerHTML = `Can't play? <a href="${lesson.suno_link}" target="_blank" rel="noopener">Listen on Suno →</a>`;
                sunoLink.style.display = 'block';
            } else {
                sunoLink.style.display = 'none';
            }
            
            // Update active state in list (clear all states first)
            document.querySelectorAll('.song-item-compact').forEach(item => {
                item.classList.remove('active', 'playing', 'paused');
            });
            document.querySelector(`[data-index="${index}"]`).classList.add('active');
            
            // Auto-play
            audio.play();
            playIcon.style.display = 'none';
            pauseIcon.style.display = 'inline-block';
        }
        
        // Setup animation for current song
        function setupSongAnimation(lessonId) {
            // Clear existing animation frames from container
            const existingLayers = albumArtContainer.querySelectorAll('.album-art-layer');
            existingLayers.forEach(layer => layer.remove());
            
            animationFramesAvailable = false;
            imageFrame1 = imageFrame2 = imageFrame3 = null;
            
            const frame1Path = `images/${lessonId}-img1.png`;
            const frame2Path = `images/${lessonId}-img2.png`;
            const frame3Path = `images/${lessonId}-img3.png`;
            
            let loadedFrames = 0;
            
            function checkImageExists(path, callback) {
                const img = new Image();
                img.onload = () => callback(true);
                img.onerror = () => callback(false);
                img.src = path;
            }
            
            checkImageExists(frame1Path, (exists1) => {
                if (exists1) {
                    imageFrame1 = document.createElement('img');
                    imageFrame1.src = frame1Path;
                    imageFrame1.className = 'album-art album-art-layer';
                    imageFrame1.setAttribute('data-frame', '1');
                    imageFrame1.style.display = 'none';
                    albumArtContainer.appendChild(imageFrame1);
                    loadedFrames++;
                }
                
                checkImageExists(frame2Path, (exists2) => {
                    if (exists2) {
                        imageFrame2 = document.createElement('img');
                        imageFrame2.src = frame2Path;
                        imageFrame2.className = 'album-art album-art-layer';
                        imageFrame2.setAttribute('data-frame', '2');
                        imageFrame2.style.display = 'none';
                        albumArtContainer.appendChild(imageFrame2);
                        loadedFrames++;
                    }
                    
                    checkImageExists(frame3Path, (exists3) => {
                        if (exists3) {
                            imageFrame3 = document.createElement('img');
                            imageFrame3.src = frame3Path;
                            imageFrame3.className = 'album-art album-art-layer';
                            imageFrame3.setAttribute('data-frame', '3');
                            imageFrame3.style.display = 'none';
                            albumArtContainer.appendChild(imageFrame3);
                            loadedFrames++;
                        }
                        
                        if (loadedFrames === 3) {
                            animationFramesAvailable = true;
                            console.log('✓ Animation available for', lessonId);
                            // If audio is already playing, start animation
                            if (!audio.paused) {
                                startAnimation();
                            }
                        } else {
                            console.log('✗ No animation for', lessonId);
                        }
                    });
                });
            });
        }
        
        // Animation functions
        function showFrame(frameNumber) {
            albumArt.style.opacity = '0';
            
            imageFrame1.style.display = 'block';
            imageFrame2.style.display = 'block';
            imageFrame3.style.display = 'block';
            
            imageFrame1.style.opacity = frameNumber === 1 ? '1' : '0';
            imageFrame2.style.opacity = frameNumber === 2 ? '1' : '0';
            imageFrame3.style.opacity = frameNumber === 3 ? '1' : '0';
        }
        
        function advanceAnimation() {
            currentPatternIndex = (currentPatternIndex + 1) % loopPattern.length;
            showFrame(loopPattern[currentPatternIndex]);
        }
        
        function startAnimation() {
            if (!animationFramesAvailable || animationInterval) return;
            
            currentPatternIndex = 0;
            showFrame(loopPattern[0]);
            animationInterval = setInterval(advanceAnimation, 10000);
        }
        
        function stopAnimation() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
        }
        
        function resetAnimation() {
            stopAnimation();
            currentPatternIndex = 0;
            
            // Hide animation frames, show default
            const layers = albumArtContainer.querySelectorAll('.album-art-layer');
            layers.forEach(layer => {
                layer.style.display = 'none';
                layer.style.opacity = '0';
            });
            albumArt.style.opacity = '1';
        }
        
        // Auto-load song if coming from a lesson page
        if (autoLoadIndex !== -1) {
            setTimeout(() => {
                loadSong(autoLoadIndex);
            }, 300);
        }
        
        // Play/Pause
        playPauseBtn.addEventListener('click', () => {
            if (currentSongIndex === -1) return;
            
            if (audio.paused) {
                audio.play();
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'inline-block';
            } else {
                audio.pause();
                playIcon.style.display = 'inline-block';
                pauseIcon.style.display = 'none';
            }
        });
        
        // Previous song
        prevBtn.addEventListener('click', () => {
            if (currentSongIndex > 0) {
                loadSong(currentSongIndex - 1);
            } else if (isRepeatAll) {
                loadSong(lessonData.length - 1);
            }
        });
        
        // Next song
        nextBtn.addEventListener('click', () => {
            if (currentSongIndex < lessonData.length - 1) {
                loadSong(currentSongIndex + 1);
            } else if (isRepeatAll) {
                loadSong(0);
            }
        });
        
        // Repeat toggle
        repeatBtn.addEventListener('click', () => {
            isRepeatAll = !isRepeatAll;
            repeatBtn.classList.toggle('repeat-active', isRepeatAll);
        });
        
        // Time updates
        audio.addEventListener('timeupdate', () => {
            if (audio.duration) {
                seekBar.value = (audio.currentTime / audio.duration) * 100;
                currentTimeEl.textContent = formatTime(audio.currentTime);
            }
        });
        
        // Animation sync with audio + Now Playing indicator
        audio.addEventListener('play', () => {
            if (animationFramesAvailable) {
                startAnimation();
            }
            // Update now playing indicator
            const activeItem = document.querySelector('.song-item-compact.active');
            if (activeItem) {
                activeItem.classList.add('playing');
                activeItem.classList.remove('paused');
            }
        });
        
        audio.addEventListener('pause', () => {
            stopAnimation();
            // Update now playing indicator
            const activeItem = document.querySelector('.song-item-compact.active');
            if (activeItem) {
                activeItem.classList.remove('playing');
                activeItem.classList.add('paused');
            }
        });
        
        audio.addEventListener('loadedmetadata', () => {
            durationEl.textContent = formatTime(audio.duration);
        });
        
        // Seek
        seekBar.addEventListener('input', () => {
            audio.currentTime = (seekBar.value / 100) * audio.duration;
        });
        
        // Auto-play next
        audio.addEventListener('ended', () => {
            if (currentSongIndex < lessonData.length - 1) {
                loadSong(currentSongIndex + 1);
            } else if (isRepeatAll) {
                loadSong(0);
            } else {
                playIcon.style.display = 'inline-block';
                pauseIcon.style.display = 'none';
                // Clear playing indicator
                const activeItem = document.querySelector('.song-item-compact.active');
                if (activeItem) {
                    activeItem.classList.remove('playing');
                }
            }
        });
        
        // Media Session API
        if ('mediaSession' in navigator) {
            audio.addEventListener('loadedmetadata', () => {
                const lesson = lessonData[currentSongIndex];
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: lesson.song_title,
                    artist: 'The Tenth Hour',
                    album: 'Hurst Class Study: Book of John',
                    artwork: lesson.image_url ? [
                        { src: lesson.image_url, sizes: '512x512', type: 'image/jpeg' }
                    ] : []
                });
            });
            
            navigator.mediaSession.setActionHandler('play', () => audio.play());
            navigator.mediaSession.setActionHandler('pause', () => audio.pause());
            navigator.mediaSession.setActionHandler('previoustrack', () => prevBtn.click());
            navigator.mediaSession.setActionHandler('nexttrack', () => nextBtn.click());
        }
    </script>
</body>
</html>
